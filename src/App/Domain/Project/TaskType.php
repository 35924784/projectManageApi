<?phpnamespace App\Domain\Project;use function App\addLog;use App\Common\CommonDomain;use App\Common\Exception\WrongRequestException;use function App\nowTime;/** * 任务类型类 * * @author lws */class TaskType extends CommonDomain{    private static $Model = null;    public function __construct()    {        if (self::$Model == null) {            self::$Model = new \App\Model\Project\TaskType();        }    }    /**     *  任务类型排序     * @param $list     */    public function exchangeTaskTypeSort($list)    {        if ($list and count($list) > 1) {            $sort_arr = $list;            sort($sort_arr);            foreach ($list as $key => $item) {                self::$Model->update($item, array('sort' => $sort_arr[$key]));            }        }    }    public function getList($param)    {        if (!is_array($param)) {            $param = get_object_vars($param);        }        if (isset($param['keyWord'])) {            $param['where']["name LIKE ? or memo = ? "] = array("%" . $param['keyWord'] . "%", $param['keyWord']);        }        $param['where']['project'] = $param['project_id'];        $list = self::$Model->getList($param);        if ($list['list']) {            $task_domain = new Task();            foreach ($list['list'] as $key => $value) {                $list['list'][$key]['list'] = array();                $list['list'][$key]['fixed_creator'] = false;                $list['list'][$key]['show_card'] = false;            }        }        return $list;    }    public function getInfo($where, $field = '*')    {        return self::$Model->getInfo($where, $field);    }    /** 删除任务类型     * @param $id int id     * @return int     * @throws WrongRequestException     */    public function delTaskType($id)    {        $task_model = new \App\Model\Project\Task();        $task = $task_model->getInfo(array('task_type' => $id, 'deleted' => '0'));        if ($task) {            throw new WrongRequestException('删除列表前必须先清空列表任务', 1);        }        $result = self::$Model->delete($id);        if ($result) {            addLog("删除项目任务类型，编号：$id");        }        return $result == true ? 0 : 1;    }    /**     *  新增任务类型     * @param $data     * @throws WrongRequestException     */    public function addTaskType($data)    {        $data['create_time'] = nowTime();        $id = self::$Model->insert($data);        if ($id === false) {            throw new WrongRequestException('新增失败', 8);        }        if (!$data['sort']) {            self::$Model->update($id, array('sort' => $id));        }        addLog('新增任务类型，编号：' . $id);        return $id;    }    public function editProjectTaskType($id, $data)    {        $result = self::$Model->update($id, $data);        if ($result === false) {            throw new WrongRequestException('保存失败', 6);        }        addLog('修改任务类型，ID：' . $id);    }}
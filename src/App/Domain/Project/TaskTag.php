<?phpnamespace App\Domain\Project;use function App\addLog;use App\Common\CommonDomain;use App\Common\Exception\WrongRequestException;use function App\nowTime;/** * 任务标签类 * * @author lws */class TaskTag extends CommonDomain{    private static $Model = null;    public function __construct()    {        if (self::$Model == null) {            self::$Model = new \App\Model\Project\TaskTag();        }    }    public function getList($param)    {        if (!is_array($param)) {            $param = get_object_vars($param);        }        if (isset($param['keyWord'])) {            $param['where']["name LIKE ? "] = array("%" . $param['keyWord'] . "%");        }        $param['where']['project'] = $param['project_id'];        $list = self::$Model->getList($param);        return $list;    }    public function getInfo($where,$field = '*')    {        return self::$Model->getInfo($where,$field);    }    /** 删除任务标签     * @param $id int id     * @return int     */    public function delTaskTag($id)    {        $task_to_tag_model = new \App\Model\Project\TaskToTag();        $task = $task_to_tag_model->deleteByWhere(array('tag_id'=>$id));        $result = self::$Model->delete($id);        if ($result) {            addLog("删除任务标签，编号：$id");        }        return $result == true ? 0 : 1;    }    /**     *  新增任务标签     * @param $data     * @return \PhalApi\long     * @throws WrongRequestException     */    public function addTaskTag($data)    {        $data['create_time'] = nowTime();        $task_id = 0;        if (isset($data['task_id']) and $data['task_id']) {            $task_id = $data['task_id'];            unset($data['task_id']);        }        $have = self::$Model->getInfo(array('name'=>$data['name'],'project'=>$data['project']));        if ($have) {            throw new WrongRequestException('不允许同名标签', 7);        }        switch ($data['color']) {            //'blue','red','orange','green','brown','purple'            case 'blue':                $data['color_value'] = '#2d8cf0';                break;            case 'red':                $data['color_value'] = '#ed3f14';                break;            case 'orange':                $data['color_value'] = '#ff9900';                break;            case 'green':                $data['color_value'] = '#19be6b';                break;            case 'brown':                $data['color_value'] = '#2fbdb3';                break;            case 'purple':                $data['color_value'] = '#797ec9';                break;        }        $id = self::$Model->insert($data);        if ($id === false) {            throw new WrongRequestException('新增失败', 8);        }        addLog('新增任务标签，编号：' . $id);        return $id;    }    public function editTaskTag($id,$data)    {        $have = self::$Model->getInfo(array('name'=>$data['name'],'project'=>$data['project'],'id <> ?'=>array($data['id'])));        if ($have) {            throw new WrongRequestException('不允许同名标签', 7);        }        $result = self::$Model->update($id,$data);        if ($result === false) {            throw new WrongRequestException('保存失败', 6);        }        addLog('修改任务标签，ID：' . $id);    }}